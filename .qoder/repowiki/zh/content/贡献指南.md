# 贡献指南

<cite>
**本文档中引用的文件**  
- [CONTRIBUTING.md](file://CONTRIBUTING.md)
- [package.json](file://package.json)
- [knip.json](file://knip.json)
- [tsconfig.json](file://tsconfig.json)
</cite>

## 目录
1. [贡献流程](#贡献流程)
2. [代码风格与提交规范](#代码风格与提交规范)
3. [本地开发环境设置](#本地开发环境设置)
4. [调试技巧](#调试技巧)
5. [工具链说明](#工具链说明)
6. [新手贡献建议](#新手贡献建议)

## 贡献流程

贡献流程从提出问题（issue）开始，适用于功能改进、bug修复或文档更新。对于小型修复（如错别字、类型修正），可直接提交拉取请求（PR）。对于新功能或重大变更，需先在 GitHub 上创建 issue 并等待核心维护者批准，未经批准的 PR 可能会被关闭。

完成开发后，需生成 changeset 条目以管理版本变更。运行 `npm run changeset` 命令，选择变更类型（major 表示破坏性变更，minor 表示新增功能，patch 表示 bug 修复），并描述变更内容。提交包含 changeset 文件的 PR 后，CI 系统将自动评估版本影响，并在合并后触发版本发布流程。

**Section sources**
- [CONTRIBUTING.md](file://CONTRIBUTING.md#L1-L193)

## 代码风格与提交规范

项目使用 Biome 工具进行代码风格管理。运行 `npm run lint` 检查代码规范，`npm run format:fix` 自动修复格式问题。所有 PR 必须通过 CI 的 linting 和 formatting 检查。

提交信息应遵循约定式提交（Conventional Commits）格式，如 "feat:"、"fix:"、"docs:" 等前缀。每次提交应关联相关 issue（使用 #issue-number）。PR 描述需清晰说明变更内容、测试步骤及是否包含破坏性变更，UI 变更应附截图。

**Section sources**
- [CONTRIBUTING.md](file://CONTRIBUTING.md#L1-L193)
- [package.json](file://package.json#L0-L498)

## 本地开发环境设置

首先克隆仓库（需安装 git-lfs）：
```bash
git clone https://github.com/cline/cline.git
```

在 VS Code 中打开项目，安装推荐的扩展。运行 `npm run install:all` 安装所有依赖（包括扩展和 webview-ui）。按 F5 启动调试，打开新 VS Code 窗口加载扩展。

Linux 用户需额外安装 GUI 系统库，如 `libgtk-3-0`、`libnss3`、`xvfb` 等，以支持扩展测试运行。

**Section sources**
- [CONTRIBUTING.md](file://CONTRIBUTING.md#L1-L193)
- [package.json](file://package.json#L0-L498)

## 调试技巧

### 调试 VS Code 扩展
使用 VS Code 内置调试功能（F5）启动扩展实例。`standalone/runtime-files/vscode` 目录包含 VS Code API 的桩实现（stubs），可用于模拟环境。通过控制台日志查看桩函数调用情况。

### 调试 gRPC 服务
核心控制器中的 `GrpcRecorder` 类负责记录 gRPC 请求/响应生命周期。它跟踪请求状态（pending、completed、error）、持续时间，并通过异步方式持久化日志。可通过 `getSessionLog()` 获取会话日志，`getStats()` 获取统计信息。`handleGrpcRequest` 函数包含记录中间件，用于捕获请求、响应和错误。

**Section sources**
- [CONTRIBUTING.md](file://CONTRIBUTING.md#L1-L193)
- [src/core/controller/grpc-recorder/grpc-recorder.ts](file://src/core/controller/grpc-recorder/grpc-recorder.ts#L1-L224)
- [src/hosts/vscode/hostbridge-grpc-handler.ts](file://src/hosts/vscode/hostbridge-grpc-handler.ts#L107-L145)
- [src/test/grpc-handler.test.ts](file://src/test/grpc-handler.test.ts#L0-L41)
- [testing-platform/harness/types.ts](file://testing-platform/harness/types.ts#L0-L13)
- [standalone/runtime-files/vscode/vscode-stubs.js](file://standalone/runtime-files/vscode/vscode-stubs.js#L1143-L1229)

## 工具链说明

项目使用多种工具保障代码质量。Biome 用于代码 linting 和 formatting。`knip` 工具检测未使用的代码，其配置在 `knip.json` 中定义入口文件和项目文件范围。`buf` 用于 protobuf 文件的 linting。`changesets` 管理版本发布。Playwright 用于端到端测试。

**Section sources**
- [knip.json](file://knip.json#L0-L23)
- [package.json](file://package.json#L0-L498)
- [tsconfig.json](file://tsconfig.json#L0-L68)

## 新手贡献建议

鼓励新贡献者从文档改进或修复小 bug 开始。GitHub 上标记为 ["good first issue"](https://github.com/cline/cline/labels/good%20first%20issue) 或 ["help wanted"](https://github.com/cline/cline/labels/help%20wanted) 的 issue 适合新手。文档贡献同样受欢迎，可改进现有指南或创建新内容。

**Section sources**
- [CONTRIBUTING.md](file://CONTRIBUTING.md#L1-L193)